<!DOCTYPE html>
<html lang="en">

<head>
    <title>Inserción de un menú desde formulario - Jilorio</title>
    <link rel="shortcut icon" href="https://doorcountypulse.com/wp-content/uploads/2020/03/forkspoon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/v4-shims.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css"> -->
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/dish.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/menu.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/fondo3.css" />


    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">

    <!-- JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>

    <!-- JQUERY AUTOCOMPLETE -->

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>







</head>

<body>
    <%- include ("../partials/navigation.ejs"); %>
        <div class="container">
            <div class="cardInside2">
                <h1>
                    <%= items.myObject.menu.title %>
                </h1>
            </div>
            <%- include ("../partials/message.ejs"); %>

                <div class="card">
                    <form method="POST" , id="aux" action='./insert'>
                        <br>
                        <% for (var i=0; i< items.myObject.menu.form.length; i++) { %>
                            <label>
                                <%= items.myObject.menu.form[i].label %>
                            </label><span class="required">*</span>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">

                                    <span class=" spanColor input-group-text"><i
                                            class=" <%= items.myObject.menu.form[i].icon %>"></i></span>

                                </div>
                                <input type="<%= items.myObject.menu.form[i].type %>" class="form-control"
                                    placeholder="<%= items.myObject.menu.form[i].placeholder %>"
                                    aria-label="<%= items.myObject.menu.form[i].ariaLabel %>"
                                    aria-describedby="basic-addon1" name="<%= items.myObject.menu.form[i].name %>"
                                    #<%=items.myObject.menu.form[i].name %>
                                required>
                            </div>
                            <% } %>
                                <br>

                                <div class="cardInside">
                                    <div class="ref">
                                        <div class="row">

                                            <% for (var i=0; i< items.myObject.menu.formPlatos.length; i++) { %>
                                                <label class="myLabels">
                                                    <%= items.myObject.menu.formPlatos[i].label %><span
                                                            class="required">*</span>
                                                </label>
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">

                                                        <span class=" spanColor input-group-text"><i
                                                                class="myIcons <%= items.myObject.menu.formPlatos[i].icon %>"></i></span>

                                                    </div>
                                                    <input type="<%= items.myObject.menu.formPlatos[i].type %>"
                                                        class="searchDish MyInputs form-control"
                                                        placeholder="<%= items.myObject.menu.formPlatos[i].placeholder %>"
                                                        aria-label="<%= items.myObject.menu.formPlatos[i].ariaLabel %>"
                                                        aria-describedby="basic-addon1"
                                                        name="<%= items.myObject.menu.formPlatos[i].name %>"
                                                        #<%=items.myObject.menu.formPlatos[i].name %> required>
                                                </div>
                                                <% } %>
                                                    <br>
                                        </div>
                                    </div>


                                </div>

                                <br>
                                <input type="button" class="btn btn-dark" value="<%= items.myObject.añadirDish %>"
                                    id="bSubmit">



                                <script>

                                    const bSubmit = document.querySelector('#bSubmit');
                                    bSubmit.addEventListener('click', () => {
                                        const ing = document.querySelector('.searchDish');
                                        const inputs = document.querySelectorAll(".MyInputs");
                                        const myLabels = document.querySelectorAll(".myLabels");
                                        const myIcons = document.querySelectorAll(".myIcons");
                                        console.log(myIcons)
                                        console.log(inputs)
                                        console.log(myLabels)
                                        createNewInputs(inputs, myLabels, myIcons);
                                    });

                                    function createNewInputs(inputs, myLabels, myIcons) {
                                        const padre = document.querySelector(".ref");
                                        const divRow = document.createElement("DIV");
                                        let k = 0;
                                        for (let i = 0; i < myLabels.length; i++) {
                                            const col = document.createElement("DIV");
                                            const aLabel = document.createElement("LABEL");
                                            console.log(myLabels[i].innerHTML)
                                            aLabel.innerHTML = myLabels[i].innerHTML;
                                            // aLabel.classList.add("required2")
                                            col.appendChild(aLabel);

                                            const divInputGroup = document.createElement("DIV");
                                            divInputGroup.classList.add("input-group");
                                            divInputGroup.classList.add("mb-3")
                                            const divInputGroupPrepend = document.createElement("DIV");
                                            divInputGroupPrepend.classList.add("input-group-prepend");

                                            const spanIcon = document.createElement("SPAN");
                                            spanIcon.classList.add("spanColor");
                                            spanIcon.classList.add("input-group-text");

                                            let icon = document.createElement("ICON");


                                            for (let j = 0; j < myIcons[i].classList.length; j++) {
                                                icon.classList.value += myIcons[i].classList[j] + " ";
                                            }

                                            spanIcon.appendChild(icon);
                                            divInputGroupPrepend.appendChild(spanIcon);
                                            divInputGroup.appendChild(divInputGroupPrepend);


                                            const newI = document.createElement("INPUT");

                                            newI.setAttribute("type", inputs[i].type);
                                            newI.setAttribute("placeholder", inputs[i].placeholder);
                                            newI.setAttribute("name", inputs[i].name);
                                            newI.classList.add("searchDish");



                                            newI.classList.add("form-control");
                                            newI.classList.add("ui-autocomplete-input");
                                            divInputGroup.appendChild(newI);
                                            col.appendChild(divInputGroup);
                                            col.classList.add("col-sm");
                                            divRow.appendChild(col);

                                        }

                                        const col = document.createElement("DIV");
                                        col.classList.add("col-sm");
                                        const eliminar = document.createElement("INPUT");
                                        eliminar.classList.add("btn");
                                        eliminar.classList.add("btn-danger");
                                        eliminar.classList.add("eliminar");
                                        eliminar.setAttribute("type", "button");
                                        eliminar.value = "<%= items.myObject.eliminar %>"
                                        col.style.display = "flex";
                                        col.style["align-items"] = "center";
                                        col.style["padding-top"] = "12px";
                                        col.appendChild(eliminar)
                                        divRow.appendChild(col);


                                        divRow.classList.add("row");
                                        padre.appendChild(divRow);

                                        $("form").on("click", ".eliminar", function (e) {
                                            var targets = $(this).closest(".row");
                                            $(targets).remove();
                                        });
                                    };




                                </script>

                                <br>
                                <div class="requiredSpan">
                                    <span class="text-muted requiredSpan">
                                        <%= items.myObject.required %>
                                    </span>
                                </div>
                                <br>
                                <input type="submit" id="mySubmit" class="btn btn-info" value="Submit" />
                </div>
                <script>
                    $(function () {
                        $(".searchDish").autocomplete({
                            source: function (req, res) {
                                $.ajax({
                                    url: "insert/autocomplete/",
                                    dataType: "jsonp",
                                    type: "GET",
                                    data: req,
                                    success: function (data) {
                                        res(data);
                                    },
                                    error: function (err) {
                                        console.log(err);
                                    }
                                });
                            },
                            minLength: 1,
                            select: function (event, ui) {
                                console.log(event);
                                console.log(ui);
                                if (ui.item) {
                                    $('.searchDish').text(ui.item.label);

                                }
                            }
                        })
                    });
                </script>
                <script>
                    $("#bSubmit").on("click", () => {
                        $(".searchDish").autocomplete({
                            source: function (req, res) {
                                $.ajax({
                                    url: "insert/autocomplete/",
                                    dataType: "jsonp",
                                    type: "GET",
                                    data: req,
                                    success: function (data) {
                                        res(data);
                                    },
                                    error: function (err) {
                                        console.log(err);
                                    }
                                });
                            },
                            minLength: 1,
                            select: function (event, ui) {
                                console.log(event);
                                console.log(ui);
                                if (ui.item) {
                                    $('.searchDish').text(ui.item.label);

                                }
                            }
                        })
                    });
                </script>

                </form>

                <br>



                <% const nombres_sz=items.myObject.tablaPlatosReducida.nombres.length %>
                    <% const nombres=items.myObject.tablaPlatosReducida.nombres %>
                        <% const docs_sz=items.myDocs.length %>
                            <% const docs=items.myDocs %>

                                <div class="cardInside3">
                                    <table id="menus" class="table table-striped table-bordered table-hover">
                                        <thead class="thead-dark">
                                            <tr>
                                                <% for (var i=0; i< nombres_sz; i++) { %>
                                                    <th scope="col">
                                                        <%= nombres[i] %>
                                                    </th>
                                                    <% } %>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <% for (var i=0; i < docs_sz; i++) { %>
                                                    <td>
                                                        <%= docs[i]._id %>
                                                    </td>
                                                    <td>
                                                        <%= items.myKcal[i] %>
                                                    </td>
                                            </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
        </div>

        <%- include ("../partials/footer.ejs"); %>
</body>

<script>
    // $(document).ready(function () {
    //     console.log("hello")
    //     $('#menus').DataTable({
    //         "language": {
    //             "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json",
    //             "emptyTable": " "
    //         },
    //         "pagingType": "simple",
    //     });
    // });

    var ejsVal = "<%= items.myObject.idioma %>"

    $(document).ready(function () {

        if (ejsVal === "esp") {
            $('#menus').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json",
                    "emptyTable": " "
                },
                "pagingType": "simple",
            });
        } else {
            $('#menus').DataTable({
                "language": {
                    "emptyTable": " "
                },
                "pagingType": "simple",
            });
        }
    });
</script>

<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>



</html>