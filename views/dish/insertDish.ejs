<!DOCTYPE html>
<html lang="en">

<head>
    <title>Document</title>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/v4-shims.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/dish.css" />


    <!-- JQUERY AUTOCOMPLETE -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>



</head>

<body>
    <%- include ("../partials/navigation.ejs"); %>
    <div class="container">
        <h1><%= items.myObject.dish.title %></h1>
        <%- include ("../partials/message.ejs"); %>

        <div class="card">
            <form method="POST" , id="aux" action='./insert'>
                <br>
                <% for (var i=0; i< items.myObject.dish.form.length; i++) { %>
                <label><%= items.myObject.dish.form[i].label %></label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">

                        <span class=" spanColor input-group-text" id="basic-addon1"><i
                                class="  <%= items.myObject.dish.form[i].icon %>"></i></span>

                    </div>
                    <input type="<%= items.myObject.dish.form[i].type %>" class="form-control"
                        placeholder="<%= items.myObject.dish.form[i].placeholder %>"
                        aria-label="<%= items.myObject.dish.form[i].ariaLabel %>" aria-describedby="basic-addon1"
                        name="<%= items.myObject.dish.form[i].name %>" #<%= items.myObject.dish.form[i].name %>>
                </div>
                <% } %>
                <br>
                <div class="cardInside">
      
                    <div class="ref">

                        <div class="row">

                            <% for (var i=0; i< items.myObject.dish.formIngredientes.length; i++) { %>
                            <div class="col-sm">
                                <label ><%= items.myObject.dish.formIngredientes[i].label %></label>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class=" spanColor input-group-text" id="basic-addon1"><i
                                                class="  <%= items.myObject.dish.formIngredientes[i].icon %>"></i></span>
                                    </div>

                                    <input class="MyInputs" id="searchIngredient"
                                        type="<%= items.myObject.dish.formIngredientes[i].type %>" class="form-control"
                                        placeholder="<%= items.myObject.dish.formIngredientes[i].placeholder %>"
                                        aria-label="<%= items.myObject.dish.formIngredientes[i].ariaLabel %>"
                                        aria-describedby="basic-addon1"
                                        name="<%= items.myObject.dish.formIngredientes[i].name %>">   
                                </div>
                            </div>
                            <% } %>
                            <% for (var i=0; i< items.myObject.dish.formIngredientesSel.length; i++) { %>
                                <div class="col-sm">
                                    <label ><%= items.myObject.dish.formIngredientesSel[i].label %></label>
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class=" spanColor input-group-text" id="basic-addon1"><i
                                                    class="  <%= items.myObject.dish.formIngredientesSel[i].icon %>"></i></span>
                                        </div>
                                        <select class="mySelects form-control" id="selectUnit" name="<%= items.myObject.dish.formIngredientesSel[i].name %>">  
                                            <% for (var j=0; j< items.myObject.dish.formIngredientesSel[i].options.length; j++) { %>
                                                <option value="<%= items.myObject.dish.formIngredientesSel[i].options[j] %>" > <%= items.myObject.dish.formIngredientesSel[i].options[j] %> </option>
                                                <% } %>
                                        </select>
 
                                       
                                    </div>
                                </div>
                                <% } %>
                        </div>

                    </div>
                    <input type="button" value="AÃ±adir ingrediente" id="bSubmit">
                </div>

                <script>
                    const bSubmit = document.querySelector('#bSubmit');
                    bSubmit.addEventListener('click', () => {
                        const ing = document.querySelector('#searchIngredient');
                        const inputs = document.querySelectorAll(".MyInputs");
                  
                        createNewInputs(inputs);
                 
                    });

                    function createNewInputs(inputs) {
                        const padre = document.querySelector(".ref");
                        const divRow = document.createElement("DIV");
                        inputs.forEach(function (input) { //posible solucion no permitir guardar cualquier valor sino que sea un select
                            const col = document.createElement("DIV");
                            const newI = document.createElement("INPUT");
                            newI.setAttribute("id", input.id);
                            newI.setAttribute("type", input.type);
                            newI.setAttribute("placeholder", input.placeholder);
                            newI.setAttribute("name", input.name);
                            newI.classList.add("form-control");
                            // newI.classList.add("MyInputs");
                            col.appendChild(newI);
                            col.classList.add("col-sm");
                            divRow.appendChild(col);
                        });
                                          const selects = document.querySelectorAll(".mySelects")
                        selects.forEach(function (sel) { //posible solucion no permitir guardar cualquier valor sino que sea un select
                            console.log(sel);
                            const col = document.createElement("DIV");
                            const newS = document.createElement("SELECT");
                            
                            newS.setAttribute("id", sel.id);
                            newS.setAttribute("name", sel.name);
                            const optS = document.createElement("OPTION");
                            optS.value = sel.options[0].value;
                            optS.innerHTML =  sel.options[0].value;
                            newS.appendChild(optS);
                            const optS2 = document.createElement("OPTION");
                            optS2.value = sel.options[1].value;
                            optS2.innerHTML =  sel.options[1].value;
                            newS.appendChild(optS2);
                            newS.classList.add("form-control");

                            col.appendChild(newS);
                            col.classList.add("col-sm");
                            divRow.appendChild(col);
                        });


                        divRow.classList.add("row");
                        padre.appendChild(divRow);
      
                 

                    }

                  
                </script>



                <br><br>
                <input type="submit" id="mySubmit" class="btn btn-info" value="Submit" />

                <script>
                    $(function () {
                        $("#searchIngredient").autocomplete({
                            source: function (req, res) {
                                $.ajax({
                                    url: "insert/autocomplete/",
                                    dataType: "jsonp",
                                    type: "GET",
                                    data: req,
                                    success: function (data) {
                                        res(data);
                                    },
                                    error: function (err) {
                                        console.log(err);
                                    }
                                });
                            },
                            minLength: 1,
                            select: function (event, ui) {
                                if (ui.item) {
                                    $('#searchIngredient').text(ui.item.label);

                                }
                            }
                        })
                    });
                </script>


            </form>
        </div>
    </div>
    <%- include ("../partials/footer.ejs"); %>



</body>

<script>
    $(document).ready(function () {
        $('#alimentos').DataTable({
            "language": {
                "emptyTable": " "
            }
        });

    });
</script>

<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>

</html>